<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Heat Exchanger Calculator - 套管换热器计算器</title>
  <link rel="icon" type="image/svg+xml" href="/vite.svg">
</head>
<body>
  <div id="app">
    <!-- 加载状态 -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
      <div class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-2 border-gray-300 border-t-blue-600 mx-auto mb-4"></div>
        <p class="text-gray-600 text-base font-medium">正在加载 CoolProp...</p>
      </div>
    </div>

    <!-- 主应用容器 -->
    <div id="main-app" class="min-h-screen bg-gray-50 py-6 px-4 hidden">
      <div class="max-w-7xl mx-auto">
        <!-- 标题区域 -->
        <header class="mb-6">
          <h1 class="text-3xl font-semibold text-gray-900 mb-1">套管换热器计算器</h1>
          <p class="text-sm text-gray-500">Heat Exchanger Calculator</p>
        </header>

        <!-- 主内容区域：左右分栏 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- 左侧：输入区域 -->
          <div class="lg:col-span-2 space-y-6">
            <!-- 输入模式选择 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">输入模式</h2>
              <div class="flex gap-4">
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="input-mode" value="flowrate" id="input-mode-flowrate" class="mr-2" checked>
                  <span class="text-sm font-medium text-gray-700">流量输入法</span>
                  <span class="ml-2 text-xs text-gray-500">(输入流量和温度，计算传热量)</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="input-mode" value="load" id="input-mode-load" class="mr-2">
                  <span class="text-sm font-medium text-gray-700">负荷输入法</span>
                  <span class="ml-2 text-xs text-gray-500">(输入传热量和温度，计算流量)</span>
                </label>
              </div>
            </div>
            
            <!-- 热流体位置选择 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">热流体位置</h2>
              <div class="flex gap-4">
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="hot-fluid-location" value="inner" id="hot-fluid-location-inner" class="mr-2" checked>
                  <span class="text-sm font-medium text-gray-700">热流体在管内</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="hot-fluid-location" value="outer" id="hot-fluid-location-outer" class="mr-2">
                  <span class="text-sm font-medium text-gray-700">热流体在管外</span>
                </label>
              </div>
              <p class="mt-2 text-xs text-gray-500">选择热流体的流动位置，冷流体在另一侧流动</p>
            </div>
            
            <!-- 流体参数 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- 热流体参数 -->
              <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">热流体参数</h2>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">工质</label>
                    <select id="hot-fluid" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="Water">水 (Water)</option>
                      <option value="R134a">R134a</option>
                      <option value="R410A">R410A</option>
                      <option value="Air">空气 (Air)</option>
                      <option value="Ethanol">乙醇 (Ethanol)</option>
                      <option value="Methanol">甲醇 (Methanol)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">过程类型</label>
                    <select id="hot-process-type" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="cooling" selected>冷却</option>
                      <option value="condensation">冷凝</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">冷却：单相状态（0或1）；冷凝：有相变</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">入口状态<span class="text-red-500">*</span></label>
                    <input type="number" id="hot-state-in" step="0.01" min="0" max="1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="1.0" value="1.0">
                    <p class="mt-1 text-xs text-gray-500">0=液体, 1=气体, 0-1=两相（干度值）</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">入口温度 (°C)</label>
                    <input type="number" id="hot-tin" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="80" value="80">
                    <p id="hot-tin-hint" class="mt-1 text-xs text-gray-500 hidden">单相换热：热流体冷却，入口温度应高于出口温度</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">出口状态<span class="text-red-500">*</span></label>
                    <input type="number" id="hot-state-out" step="0.01" min="0" max="1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.0" value="0.0">
                    <p class="mt-1 text-xs text-gray-500">0=液体, 1=气体, 0-1=两相（干度值）</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">出口温度 (°C)</label>
                    <input type="number" id="hot-tout" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="60" value="60">
                    <p id="hot-tout-hint" class="mt-1 text-xs text-gray-500 hidden">单相换热：热流体冷却，出口温度应低于入口温度</p>
                  </div>
                  <div id="hot-flowrate-container">
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      <span id="hot-flowrate-label">质量流量 (kg/s)</span>
                      <span id="hot-flowrate-calculated" class="text-blue-600 ml-2 text-xs font-normal hidden">(计算值)</span>
                    </label>
                    <input type="number" id="hot-flowrate" step="0.01" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.5" value="0.5">
                  </div>
                  <div id="hot-pressure-container">
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      压力 (kPa)
                      <span id="hot-pressure-required" class="text-red-500">*</span>
                    </label>
                    <input type="number" id="hot-pressure" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="101.325" value="101.325">
                    <p class="mt-1 text-xs text-gray-500">请输入热流体进口压力</p>
                  </div>
                </div>
              </div>

              <!-- 冷流体参数 -->
              <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">冷流体参数</h2>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">工质</label>
                    <select id="cold-fluid" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="Water">水 (Water)</option>
                      <option value="R134a">R134a</option>
                      <option value="R410A">R410A</option>
                      <option value="Air">空气 (Air)</option>
                      <option value="Ethanol">乙醇 (Ethanol)</option>
                      <option value="Methanol">甲醇 (Methanol)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">过程类型</label>
                    <select id="cold-process-type" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="cooling" selected>加热</option>
                      <option value="evaporation">蒸发</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">加热：单相状态（0或1）；蒸发：有相变</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">入口状态<span class="text-red-500">*</span></label>
                    <input type="number" id="cold-state-in" step="0.01" min="0" max="1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.0" value="0.0">
                    <p class="mt-1 text-xs text-gray-500">0=液体, 1=气体, 0-1=两相（干度值）</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">入口温度 (°C)</label>
                    <input type="number" id="cold-tin" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="20" value="20">
                    <p id="cold-tin-hint" class="mt-1 text-xs text-gray-500 hidden">单相换热：冷流体加热，入口温度应低于出口温度</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">出口状态<span class="text-red-500">*</span></label>
                    <input type="number" id="cold-state-out" step="0.01" min="0" max="1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.0" value="0.0">
                    <p class="mt-1 text-xs text-gray-500">0=液体, 1=气体, 0-1=两相（干度值）</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">出口温度 (°C)</label>
                    <input type="number" id="cold-tout" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="40" value="40">
                    <p id="cold-tout-hint" class="mt-1 text-xs text-gray-500 hidden">单相换热：冷流体加热，出口温度应高于入口温度</p>
                  </div>
                  <div id="cold-flowrate-container">
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      <span id="cold-flowrate-label">质量流量 (kg/s)</span>
                      <span id="cold-flowrate-calculated" class="text-blue-600 ml-2 text-xs font-normal hidden">(计算值)</span>
                    </label>
                    <input type="number" id="cold-flowrate" step="0.01" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="0.5" value="0.5">
                  </div>
                  <div id="cold-pressure-container">
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      压力 (kPa)
                      <span id="cold-pressure-required" class="text-red-500">*</span>
                    </label>
                    <input type="number" id="cold-pressure" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="101.325" value="101.325">
                    <p class="mt-1 text-xs text-gray-500">请输入冷流体进口压力</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 传热量输入（负荷输入法模式） -->
            <div id="heat-load-input-container" class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 hidden">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">传热负荷</h2>
              <div>
                <label class="block text-xs font-medium text-gray-700 mb-1.5">传热量 (kW)<span class="text-red-500">*</span></label>
                <input type="number" id="heat-load" step="0.001" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="输入传热量">
                <p class="mt-1 text-xs text-gray-500">输入需要传递的热负荷，系统将计算所需的流体流量</p>
              </div>
            </div>

            <!-- 换热器参数 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
              <h2 class="text-lg font-semibold text-gray-900 mb-5">换热器参数</h2>
              
              <!-- 内管类型选择 -->
              <div class="mb-5 p-4 bg-blue-50 rounded-lg border border-blue-100">
                <label class="block text-sm font-semibold text-gray-900 mb-2">
                  <span class="text-red-500">*</span> 内管类型选择
                </label>
                <select id="inner-tube-type" class="w-full md:w-1/2 px-4 py-2.5 text-sm rounded-lg border border-blue-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white font-medium transition-all">
                  <option value="smooth">光管 (Smooth Tube)</option>
                  <option value="twisted">麻花管 (Twisted Tube)</option>
                </select>
                <p class="mt-2 text-xs text-gray-600">选择内管类型后，将显示对应的输入参数</p>
              </div>
              
              <!-- 外管参数 -->
              <div class="mb-5">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">外管参数</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">外管外径 (mm)<span class="text-red-500">*</span></label>
                    <input type="number" id="outer-outer-diameter" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="38" value="38">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">外管壁厚 (mm)<span class="text-red-500">*</span></label>
                    <input type="number" id="outer-wall-thickness" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="2.0" value="2.0">
                  </div>
                </div>
                <div class="mt-2 text-xs text-gray-500">外管内径 = 外管外径 - 2×外管壁厚</div>
              </div>
              
              <!-- 光管参数区域 -->
              <div id="smooth-tube-params" class="mb-5">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">光管参数</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">内管外径 (mm)<span class="text-red-500">*</span></label>
                    <input type="number" id="inner-outer-diameter" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="20" value="20">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">内管壁厚 (mm)<span class="text-red-500">*</span></label>
                    <input type="number" id="inner-wall-thickness" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="2.0" value="2.0">
                  </div>
                </div>
                <div class="mt-3">
                  <label class="block text-xs font-medium text-gray-700 mb-1.5">内管数量</label>
                  <select id="inner-tube-count" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                    <option value="1" selected>1 根</option>
                    <option value="2">2 根</option>
                    <option value="3">3 根</option>
                    <option value="4">4 根</option>
                    <option value="5">5 根</option>
                    <option value="6">6 根</option>
                    <option value="7">7 根</option>
                    <option value="8">8 根</option>
                    <option value="9">9 根</option>
                    <option value="10">10 根</option>
                  </select>
                </div>
                <div class="mt-2 text-xs text-gray-500">内管内径 = 内管外径 - 2×内管壁厚</div>
              </div>
              
              <!-- 内管材质选择（光管和麻花管共用） -->
              <div class="mb-5">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">内管材质</h3>
                <div>
                  <label class="block text-xs font-medium text-gray-700 mb-1.5">
                    内管材质<span class="text-red-500">*</span>
                  </label>
                  <select id="inner-tube-material" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white" required>
                    <option value="stainless-steel-304" selected>不锈钢 304</option>
                    <option value="stainless-steel-316">不锈钢 316</option>
                    <option value="stainless-steel-316l">不锈钢 316L</option>
                    <option value="carbon-steel">碳钢</option>
                    <option value="copper">铜</option>
                    <option value="aluminum">铝</option>
                    <option value="titanium">钛</option>
                    <option value="brass">黄铜</option>
                    <option value="nickel">镍</option>
                    <option value="hastelloy">哈氏合金</option>
                    <option value="monel">蒙乃尔</option>
                    <option value="duplex-steel">双相不锈钢</option>
                  </select>
                  <p class="mt-1 text-xs text-gray-500" id="material-description">奥氏体不锈钢，耐腐蚀性好，适用于一般换热器</p>
                </div>
              </div>
              
              <!-- 麻花管参数区域 -->
              <div id="twisted-tube-params" class="mb-5 hidden">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">麻花管参数</h3>
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-3">
                  <div class="text-xs text-amber-800">
                    <span class="font-semibold">注意：</span>麻花管模式下，只支持单根内管，且麻花管外径自动等于外管内径（贴合状态）。
                  </div>
                </div>
                <!-- 麻花管预设选项 -->
                <div class="mb-4">
                  <label class="block text-xs font-medium text-gray-700 mb-1.5">
                    麻花管类型（预设）<span class="text-gray-400 text-xs">(可选)</span>
                  </label>
                  <select id="twisted-tube-preset" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                    <option value="">自定义</option>
                    <option value="35">外管外径 35mm</option>
                    <option value="38" selected>外管外径 38mm</option>
                    <option value="42">外管外径 42mm</option>
                  </select>
                  <p class="mt-1 text-xs text-gray-500">选择预设类型将自动填充相应参数</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      头数（瓣数）<span class="text-red-500">*</span>
                    </label>
                    <select id="twist-lobe-count" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="3">3头</option>
                      <option value="4">4头</option>
                      <option value="5">5头</option>
                      <option value="6" selected>6头</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      螺旋节距/齿距 (mm)<span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="twist-pitch" step="0.1" min="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="6.5" value="6.5">
                    <p class="mt-1 text-xs text-gray-500">沿螺旋轴线测量的相邻两齿对应点之间的距离</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      齿高 (mm)<span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="twist-tooth-height" step="0.1" min="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="3.0" value="3.0">
                    <p class="mt-1 text-xs text-gray-500">梅花截面从谷底到峰顶的单边高度</p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">
                      麻花管壁厚 (mm)
                    </label>
                    <input type="number" id="twist-wall-thickness" step="0.1" min="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="使用内管壁厚">
                    <p class="mt-1 text-xs text-gray-500">留空则使用内管壁厚</p>
                  </div>
                </div>
                <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                  <h4 class="text-xs font-semibold text-gray-700 mb-2">计算后的几何参数</h4>
                  <div class="grid grid-cols-2 gap-3 text-xs">
                    <div>
                      <span class="text-gray-600">麻花管外径:</span>
                      <span id="calc-twist-outer-diameter" class="font-semibold ml-1 text-blue-600">-</span> mm
                    </div>
                    <div>
                      <span class="text-gray-600">麻花管内径:</span>
                      <span id="calc-twist-inner-diameter" class="font-semibold ml-1 text-blue-600">-</span> mm
                    </div>
                    <div>
                      <span class="text-gray-600">当量直径:</span>
                      <span id="calc-twist-equivalent-diameter" class="font-semibold ml-1 text-green-600">-</span> mm
                    </div>
                    <div>
                      <span class="text-gray-600">流通面积:</span>
                      <span id="calc-twist-flow-area" class="font-semibold ml-1 text-green-600">-</span> m²
                    </div>
                  </div>
                </div>
                
                <!-- 麻花管几何说明图示 -->
                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                  <h4 class="text-xs font-semibold text-blue-900 mb-3">麻花管几何说明</h4>
                  <div class="mb-3">
                    <img 
                      id="plum-blossom-diagram" 
                      src="/plum-blossom-diagram.png" 
                      alt="34mm Circle with 6-Lobe Inscribed 'Plum Blossom' Shape"
                      class="w-full max-w-md mx-auto border border-blue-300 rounded-lg shadow-sm"
                      style="display: none;"
                      onerror="this.style.display='none'; document.getElementById('diagram-fallback').style.display='block';"
                    >
                    <div id="diagram-fallback" class="text-xs text-blue-800 space-y-2" style="display: none;">
                      <p class="font-semibold">麻花管几何说明：</p>
                      <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><span class="font-medium">外圆（黑色）</span>：代表直径34mm的外管内径</li>
                        <li><span class="font-medium">梅花形状（红色）</span>：内切的6瓣梅花形状</li>
                        <li><span class="font-medium">空隙区域（天蓝色）</span>：外圆与梅花形状之间的6个空隙</li>
                        <li><span class="font-medium">深度3mm</span>：从外圆表面到梅花凹槽底部的深度</li>
                        <li><span class="font-medium">总空隙面积</span>：约149.62 mm²</li>
                        <li><span class="font-medium">等效圆直径</span>：约13.80 mm</li>
                      </ul>
                      <p class="text-xs text-blue-600 mt-2">
                        <span class="font-semibold">计算方法：</span>空隙面积 = 外圆面积 - 梅花形状面积
                      </p>
                    </div>
                  </div>
                  <div class="text-xs text-blue-700 bg-white p-2 rounded border border-blue-200">
                    <p class="font-semibold mb-1">空隙面积计算逻辑：</p>
                    <p>代码中使用 <code class="bg-blue-100 px-1 rounded text-xs">空隙面积 = 外圆面积 - 梅花形状面积</code> 的方法，其中：</p>
                    <ul class="list-disc list-inside space-y-1 ml-2 mt-1">
                      <li>外圆面积 = π × (外管内径/2)²</li>
                      <li>梅花形状面积 = calculateLobeCrossSection(doMax, doMin, lobeCount).area</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- 通用参数 -->
              <div class="mt-5 pt-5 border-t border-gray-200">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">通用参数</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">管长 (m)<span class="text-red-500">*</span></label>
                    <input type="number" id="length" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="5.0" value="5.0">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">流动方式<span class="text-red-500">*</span></label>
                    <select id="flow-type" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="counter">逆流 (Counter Flow)</option>
                      <option value="parallel">并流 (Parallel Flow)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">流程数量</label>
                    <select id="pass-count" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="1" selected>1 个流程</option>
                      <option value="2">2 个流程</option>
                      <option value="3">3 个流程</option>
                      <option value="4">4 个流程</option>
                      <option value="5">5 个流程</option>
                      <option value="6">6 个流程</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">每流程外管数量</label>
                    <select id="outer-tube-count-per-pass" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all">
                      <option value="1" selected>1 根</option>
                      <option value="2">2 根</option>
                      <option value="3">3 根</option>
                      <option value="4">4 根</option>
                      <option value="5">5 根</option>
                      <option value="6">6 根</option>
                      <option value="7">7 根</option>
                      <option value="8">8 根</option>
                      <option value="9">9 根</option>
                      <option value="10">10 根</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div class="mt-5">
                <label class="block text-xs font-medium text-gray-700 mb-1.5">传热系数 (W/m²·K) <span class="text-gray-500">(可选，留空则自动计算)</span></label>
                <input type="number" id="heat-transfer-coefficient" step="0.1" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="留空自动计算">
              </div>
              
              <!-- 污垢系数 -->
              <div class="mt-5 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                <h3 class="text-sm font-semibold text-amber-900 mb-3">污垢系数（可选）</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">管内污垢热阻 (m²·K/kW)</label>
                    <input type="number" id="fouling-inner" step="0.01" min="0" class="w-full px-3 py-2 text-sm rounded-lg border border-amber-300 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all bg-white" placeholder="0 (无污垢)" value="0">
                    <p class="mt-1 text-xs text-amber-700">
                      <span class="font-semibold">常用值：</span><br>
                      水：0.1~0.2 m²·K/kW<br>
                      油：0.2~0.5 m²·K/kW<br>
                      盐水：0.2~0.4 m²·K/kW<br>
                      蒸汽（冷凝）：0.09 m²·K/kW
                    </p>
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1.5">管外污垢热阻 (m²·K/kW)</label>
                    <input type="number" id="fouling-outer" step="0.01" min="0" class="w-full px-3 py-2 text-sm rounded-lg border border-amber-300 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all bg-white" placeholder="0 (无污垢)" value="0">
                    <p class="mt-1 text-xs text-amber-700">
                      <span class="font-semibold">常用值：</span><br>
                      水：0.1~0.2 m²·K/kW<br>
                      油：0.2~0.5 m²·K/kW<br>
                      盐水：0.2~0.4 m²·K/kW<br>
                      蒸汽（冷凝）：0.09 m²·K/kW
                    </p>
                  </div>
                </div>
                <p class="mt-2 text-xs text-amber-800">
                  <span class="font-semibold">说明：</span>污垢热阻反映换热器运行一段时间后污垢沉积对传热的影响。输入0表示无污垢（设计工况），输入实际值可评估运行后的传热性能。单位 m²·K/kW 表示每千瓦传热功率所需的污垢热阻面积。
                </p>
              </div>
            </div>

            <!-- 计算按钮 -->
            <div class="flex justify-center">
              <button id="calculate-btn" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 transition-all duration-200 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                计算
              </button>
            </div>

            <!-- 结果展示区域 -->
            <div id="results" class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 hidden">
              <h2 class="text-lg font-semibold text-gray-900 mb-4">计算结果</h2>
              
              <!-- 计算流量（负荷输入法时显示） -->
              <div id="calculated-flowrate-container" class="mb-4 bg-gray-50 rounded-lg p-4 border border-gray-200 hidden">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">计算流量（负荷输入法）</h3>
                <div class="grid grid-cols-2 gap-3">
                  <div class="bg-red-50 rounded-lg p-3 border border-red-100">
                    <div class="text-xs text-gray-600 mb-1">热流体流量</div>
                    <div id="result-calculated-hot-flowrate" class="text-lg font-bold text-red-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">kg/s</div>
                  </div>
                  <div class="bg-blue-50 rounded-lg p-3 border border-blue-100">
                    <div class="text-xs text-gray-600 mb-1">冷流体流量</div>
                    <div id="result-calculated-cold-flowrate" class="text-lg font-bold text-blue-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">kg/s</div>
                  </div>
                </div>
              </div>
              
              <!-- 热工参数 -->
              <div class="mb-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">热工参数</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                    <div class="text-xs text-gray-600 mb-1">传热量</div>
                    <div id="result-q" class="text-xl font-bold text-blue-700">-</div>
                  <div id="result-phase-info" class="mt-2 text-xs text-gray-600 hidden">
                    <div class="flex flex-wrap gap-2">
                      <span id="result-hot-phase" class="px-2 py-1 bg-red-100 text-red-700 rounded"></span>
                      <span id="result-cold-phase" class="px-2 py-1 bg-blue-100 text-blue-700 rounded"></span>
                    </div>
                  </div>
                    <div class="text-xs text-gray-500 mt-1">kW</div>
                  </div>
                  <div class="bg-green-50 rounded-lg p-4 border border-green-100">
                    <div class="text-xs text-gray-600 mb-1">对数平均温差</div>
                    <div id="result-lmtd" class="text-xl font-bold text-green-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">°C</div>
                  </div>
                  <div class="bg-purple-50 rounded-lg p-4 border border-purple-100">
                    <div class="text-xs text-gray-600 mb-1">传热系数</div>
                    <div id="result-u" class="text-xl font-bold text-purple-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">W/m²·K</div>
                  </div>
                  <div class="bg-orange-50 rounded-lg p-4 border border-orange-100">
                    <div class="text-xs text-gray-600 mb-1">换热面积</div>
                    <div id="result-area" class="text-xl font-bold text-orange-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">m² <span class="text-gray-400">(实际面积)</span></div>
                  </div>
                </div>
              </div>
              
              <!-- 面积余量分析 -->
              <div class="mb-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">面积余量分析</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                  <div class="bg-amber-50 rounded-lg p-4 border border-amber-100">
                    <div class="text-xs text-gray-600 mb-1">所需换热面积</div>
                    <div id="result-required-area" class="text-xl font-bold text-amber-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">m²</div>
                  </div>
                  <div class="bg-rose-50 rounded-lg p-4 border border-rose-100">
                    <div class="text-xs text-gray-600 mb-1">面积余量</div>
                    <div id="result-area-margin" class="text-xl font-bold text-rose-700">-</div>
                  </div>
                  <div class="md:col-span-1">
                    <div id="result-area-margin-status" class="hidden"></div>
                  </div>
                </div>
              </div>
              
              <!-- 阻力损失参数 -->
              <div class="mb-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">阻力损失</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div class="bg-cyan-50 rounded-lg p-4 border border-cyan-100">
                    <div class="text-xs text-gray-600 mb-1">管内压降</div>
                    <div id="result-inner-pressure" class="text-xl font-bold text-cyan-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">kPa</div>
                  </div>
                  <div class="bg-teal-50 rounded-lg p-4 border border-teal-100">
                    <div class="text-xs text-gray-600 mb-1">管外压降</div>
                    <div id="result-annulus-pressure" class="text-xl font-bold text-teal-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">kPa</div>
                  </div>
                  <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-100">
                    <div class="text-xs text-gray-600 mb-1">管内摩擦系数</div>
                    <div id="result-inner-friction" class="text-lg font-bold text-indigo-700">-</div>
                  </div>
                  <div class="bg-pink-50 rounded-lg p-4 border border-pink-100">
                    <div class="text-xs text-gray-600 mb-1">管外摩擦系数</div>
                    <div id="result-annulus-friction" class="text-lg font-bold text-pink-700">-</div>
                  </div>
                </div>
              </div>
              
              <!-- 温度分布曲线 -->
              <div class="mt-6 mb-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">温度分布曲线</h3>
                <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
                  <canvas
                    id="temperature-distribution-canvas"
                    class="w-full border border-gray-300 rounded-lg bg-white"
                    style="height: 450px;"
                  ></canvas>
                </div>
                <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                  <div class="text-xs text-blue-800 space-y-1">
                    <p><span class="font-semibold">说明：</span></p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li><span class="font-medium text-red-600">红色曲线</span>表示热流体温度沿换热器长度的变化</li>
                      <li><span class="font-medium text-blue-600">蓝色曲线</span>表示冷流体温度沿换热器长度的变化</li>
                      <li>横坐标为沿换热器的位置（从入口到出口），单位为米 (m)</li>
                      <li>纵坐标为流体温度，单位为摄氏度 (°C)</li>
                      <li>图中标注了四个端点温度：<span class="font-medium">Th,in</span>（热流体入口）、<span class="font-medium">Th,out</span>（热流体出口）、<span class="font-medium">Tc,in</span>（冷流体入口）、<span class="font-medium">Tc,out</span>（冷流体出口）</li>
                      <li><span class="font-medium text-green-600">绿色虚线</span>标注了<span class="font-semibold">最小温差（逼近温差 ΔT_min）</span>，这是换热器设计中的关键参数，表示两流体之间的最小温度差</li>
                      <li>图表底部显示了<span class="font-medium">流动方向箭头</span>，红色箭头表示热流体流动方向，蓝色箭头表示冷流体流动方向</li>
                      <li id="flow-type-note" class="mt-2">
                        <span class="font-semibold">逆流流动：</span>热流体和冷流体从相反方向流动，传热效率较高，两流体温度差较为均匀，可以实现更低的出口温度。最小温差通常出现在换热器的一端
                      </li>
                      <li id="parallel-flow-note" class="hidden">
                        <span class="font-semibold">并流流动：</span>热流体和冷流体从同一方向流动，入口端温差大，出口端温差小，传热效率相对较低，但可以避免局部过热。最小温差出现在出口端
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- 麻花管几何属性（仅麻花管时显示） -->
              <div id="twisted-geometry-info" class="mt-6 mb-4 hidden"></div>
              
              <!-- 热阻分配比例 -->
              <div class="mt-6 mb-4">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">热阻分配比例</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                  <div class="bg-red-50 rounded-lg p-4 border border-red-100">
                    <div class="text-xs text-gray-600 mb-1">管内热阻</div>
                    <div id="result-ri-percentage" class="text-xl font-bold text-red-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">管内对流传热热阻占比</div>
                  </div>
                  <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                    <div class="text-xs text-gray-600 mb-1">管外热阻</div>
                    <div id="result-ro-percentage" class="text-xl font-bold text-blue-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">管外对流传热热阻占比</div>
                  </div>
                  <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                    <div class="text-xs text-gray-600 mb-1">管壁热阻</div>
                    <div id="result-rwall-percentage" class="text-xl font-bold text-gray-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">管壁导热热阻占比</div>
                  </div>
                  <div class="bg-orange-50 rounded-lg p-4 border border-orange-100">
                    <div class="text-xs text-gray-600 mb-1">管内污垢热阻</div>
                    <div id="result-rfi-percentage" class="text-xl font-bold text-orange-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">管内污垢热阻占比</div>
                  </div>
                  <div class="bg-amber-50 rounded-lg p-4 border border-amber-100">
                    <div class="text-xs text-gray-600 mb-1">管外污垢热阻</div>
                    <div id="result-rfo-percentage" class="text-xl font-bold text-amber-700">-</div>
                    <div class="text-xs text-gray-500 mt-1">管外污垢热阻占比</div>
                  </div>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                  <div class="text-xs text-purple-800 space-y-1">
                    <p><span class="font-semibold">说明：</span></p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                      <li>总热阻 = 管内热阻 + 管外热阻 + 管壁热阻 + 管内污垢热阻 + 管外污垢热阻</li>
                      <li><span class="font-medium text-red-600">管内热阻</span>：热流体与内管内壁的对流传热热阻</li>
                      <li><span class="font-medium text-blue-600">管外热阻</span>：冷流体与内管外壁（或外管内壁）的对流传热热阻</li>
                      <li><span class="font-medium text-gray-600">管壁热阻</span>：管壁材料的导热热阻（通常较小，可忽略）</li>
                      <li><span class="font-medium text-orange-600">管内污垢热阻</span>：管内壁污垢沉积造成的热阻（取决于流体类型和运行时间）</li>
                      <li><span class="font-medium text-amber-600">管外污垢热阻</span>：管外壁污垢沉积造成的热阻（取决于流体类型和运行时间）</li>
                      <li>热阻越大，传热越困难；优化传热应降低占比最大的热阻。污垢热阻会随运行时间增加而增大，导致传热性能下降。</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <div id="error-message" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm hidden"></div>
            </div>
          </div>

          <!-- 右侧：可视化区域 -->
          <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 sticky top-6">
              <h2 class="text-lg font-semibold text-gray-900 mb-3">截面图</h2>
              <p class="text-xs text-gray-500 mb-4">显示单管截面图，包含主要尺寸标注</p>
              <div class="w-full">
                <canvas
                  id="front-view-canvas"
                  class="w-full border border-gray-200 rounded-lg bg-gray-50"
                  style="aspect-ratio: 1;"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>
</html>
